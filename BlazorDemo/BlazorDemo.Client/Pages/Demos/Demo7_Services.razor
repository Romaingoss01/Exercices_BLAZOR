@page "/demo7"

@inject IProduitServiceClient ProduitService

<h1> Services - <code>@@inject</code> et DI</h1>

<div class="alert alert-success">
    <h4>Concepts:</h4>
    <ul>
        <li><code>@@inject</code> - Injecter un service</li>
        <li><code>OnInitializedAsync</code> - Charger les donn√©es</li>
        <li>Service client avec HttpClient</li>
    </ul>
</div>

<hr />

<div class="card mb-3">
    <div class="card-header d-flex justify-content-between align-items-center">
        <span>üì¶ Produits (depuis l'API)</span>
        <button class="btn btn-sm btn-outline-primary" @onclick="Charger">üîÑ Recharger</button>
    </div>
    <div class="card-body">
        @if (chargement)
        {
            <div class="text-center py-4">
                <div class="spinner-border text-primary"></div>
                <p class="mt-2">Chargement...</p>
            </div>
        }
        else
        {
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr><th>ID</th><th>Nom</th><th>Prix</th><th>Stock</th></tr>
                </thead>
                <tbody>
                    @foreach (var p in produits)
                    {
                        <tr>
                            <td>@p.Id</td>
                            <td>@p.Nom</td>
                            <td class="text-success fw-bold">@p.Prix.ToString("C")</td>
                            <td><span class="badge @(p.Stock > 0 ? "bg-success" : "bg-danger")">@p.Stock</span></td>
                        </tr>
                    }
                </tbody>
            </table>
        }
    </div>
</div>



<hr />

<div class="card">
    <div class="card-header bg-light">üìù Code Source</div>
    <div class="card-body bg-dark">
        <pre class="mb-0 text-success"><code>@@inject IProduitServiceClient ProduitService

@@code {
    private List&lt;Produit&gt; produits = new();

    protected override async Task OnInitializedAsync()
    {
        produits = await ProduitService.ObtenirTousAsync();
    }
}</code></pre>
    </div>
</div>

@code {
    private List<Produit> produits = new();
    private bool chargement = true;

    protected override async Task OnInitializedAsync() => await Charger();

    private async Task Charger()
    {
        chargement = true;
        produits = await ProduitService.ObtenirTousAsync();
        chargement = false;
    }
}
